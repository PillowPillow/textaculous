// textaculous
// version: 0.1.0
// author: 
// generated: Thu Apr 23 2015 16:36:11 GMT+0200 (Paris, Madrid (heure d’été))
// Autogenerated, do not edit. All changes will be undone.
!function(a,b,angular){" use strict; ";angular.module("textaculous",[]),angular.module("textaculous").constant("textaculous.constants.config",{tag:"@",classes:"drop-theme-arrows-bounce",position:"bottom left"}),angular.module("textaculous").run(["$templateCache",function(a){a.put("../lib/templates/textaculous.jade",'<section class="front">\n  <textarea ng-click="selectText($event)" ng-model="raw" ng-trim="false" wrap="hard"></textarea>\n</section>\n<section class="back">\n  <pre class="highlight"><span ng-repeat="part in Textaculous.text track by $index"><span ng-if="!isHighlighted($index)">{{part}}</span><span ng-if="isHighlighted($index)" class="highlighted">{{part}}</span></span></pre>\n</section>\n<section class="hidden-container">\n  <article class="tether-pop"></article>\n</section>')}]),angular.module("textaculous").service("textaculous.drop",["textaculous.parser","textaculous.constants.config",function(a,c){function d(b,c){var d=b.highlightedRanges,e=b.positionStart,f=b.positionEnd,g=b.event,h=b.node;f=f||e;var i=a.isInRange(d,{start:e,end:f});return~i?(this.pop({index:i,node:h},c),g&&g.stopPropagation()):this.close(),i}function e(a,b){var d=a.index,e=a.node,f=void 0===d?e:e.querySelectorAll(".highlighted")[d];f&&f!==k&&(j&&j.destroy(),j=new Drop({target:f,content:b,classes:c.classes,position:c.position,constrainToWindow:!1,constrainToScrollParent:!1,openOn:""}),k=f,j.content.addEventListener("click",function(a){return a.stopPropagation()}),j.setupTether(),j.open())}function f(){j&&(k=null,j.close(),g())}function g(){for(var a=0;a<l.length;a++)l[a].call()}function h(a){l.push(a)}function i(){var a=this,c=b.querySelector("html");c.addEventListener("click",function(){return a.close()})}var j,k,l=[];this.trigger=d,this.pop=e,this.close=f,this.onClose=h,this._init=i,this._init()}]),angular.module("textaculous").service("textaculous.parser",["textaculous.constants.config",function(a){function b(a,b){for(var c=b.start,d=b.end,e=-1,f=0;f<a.length;f++)if(a[f][0]<=c&&d<=a[f][1]){e=f;break}return e}function c(b){for(var c=d(b),e=0,f=[],g=[],h=[],i=0;i<c.length;i++)c[i][0]===a.tag&&c[i].length>1&&(h.push(c[i]),g.push(i),f.push([e,e+c[i].length])),e+=c[i].length;return{splitted:c,highlightedRanges:f,highlighted:h,highlightedIndexes:g}}function d(a){return a.split(f)}function e(a){return new RegExp("(\\"+a+"[^\\s]+)")}var f=e(a.tag);this.parse=c,this.isInRange=b}]),angular.module("textaculous").controller("textaculous.controllers.textaculous",function(){this.$$ranges=[],this.$$highlighted=[],this.$$highlightedIndexes=[],this.$$textarea=void 0,this.$$tetherContent=void 0,this.$$currentIndex=-1});var c=function(a,b){if(Array.isArray(a))return a;if(Symbol.iterator in Object(a)){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(i){e=!0,f=i}finally{try{!d&&h["return"]&&h["return"]()}finally{if(e)throw f}}return c}throw new TypeError("Invalid attempt to destructure non-iterable instance")};angular.module("textaculous").directive("textaculous",["textaculous.parser","textaculous.drop","$interval",function(a,b,d){return{scope:{raw:"=ngModel"},restrict:"AE",templateUrl:"../lib/templates/textaculous.jade",controller:"textaculous.controllers.textaculous",controllerAs:"Textaculous",require:["textaculous","ngModel"],transclude:!0,compile:function(){return function(d,e,f,g,h){function i(){n.start=void 0,n.end=void 0}function j(a){return d.raw=""+d.raw.slice(0,l.$$ranges[l.$$currentIndex][0]+1)+a+d.raw.slice(l.$$ranges[l.$$currentIndex][1])}var k=c(g,2),l=k[0],m=(k[1],e[0]),n={start:void 0,end:void 0};l.text=[],l.$$ranges=[],l.$$highlighted=[],l.$$textarea=m.querySelector("textarea"),l.$$tetherContent=m.querySelector(".tether-pop"),l.$$currentIndex=-1,Object.defineProperties(l,{range:{get:function(){return~l.$$currentIndex?l.$$ranges[l.$$currentIndex]:void 0}},current:{get:function(){return~l.$$currentIndex?l.$$highlighted[l.$$currentIndex].slice(1):""},set:function(a){return!!~l.$$currentIndex&&j(a)}}}),angular.element(l.$$textarea).on("keydown keyup",i),b.onClose(i),d.selectText=function(a){return i(),l.$$currentIndex=b.trigger({highlightedRanges:l.$$ranges,positionStart:l.$$textarea.selectionStart,positionEnd:l.$$textarea.selectionEnd,event:a,node:m},l.$$tetherContent),~l.$$currentIndex&&(n.start=l.$$textarea.selectionStart,n.end=l.$$textarea.selectionEnd),l.$$currentIndex},d.isHighlighted=function(a){return!!~l.$$highlightedIndexes.indexOf(a)},d.$watch("raw",function(c){var d=a.parse(c),e=d.highlightedRanges,f=d.splitted,g=d.highlighted,h=d.highlightedIndexes;l.text=f,l.$$ranges=e,l.$$highlighted=g,l.$$highlightedIndexes=h,void 0!==n.start&&void 0!==n.end&&(l.$$textarea.selectionStart=n.start,l.$$textarea.selectionEnd=n.end);var i=a.isInRange(l.$$ranges,{start:l.$$textarea.selectionStart,end:l.$$textarea.selectionEnd});~i?l.$$currentIndex=i:(b.close(),l.$$currentIndex=-1)}),h(d,function(a){return angular.element(l.$$tetherContent).append(a)})}}}}]),angular.module("textaculous").directive("highlighted",["textaculous.drop",function(a){return{restrict:"C",scope:{},require:"^textaculous",link:function(b,c,d,e){a.pop({node:c[0]},e.$$tetherContent)}}}])}(window,window.document,window.angular);