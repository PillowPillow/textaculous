// textaculous
// version: 0.1.0
// author: 
// generated: Wed Apr 22 2015 15:17:53 GMT+0200 (Paris, Madrid (heure d’été))
// Autogenerated, do not edit. All changes will be undone.
!function(a,b,angular){" use strict; ";angular.module("textaculous",[]),angular.module("textaculous").constant("textaculous.constants.config",{tag:"@"}),angular.module("textaculous").run(["$templateCache",function(a){a.put("../lib/templates/textaculous.jade",'<section class="front">\n  <textarea ng-click="selectText($event)" ng-model="raw" ng-trim="false" wrap="hard"></textarea>\n</section>\n<section class="back">\n  <pre class="highlight"><span ng-repeat="part in Textaculous.text track by $index"><span ng-if="!isHighlighted($index)">{{part}}</span><span ng-if="isHighlighted($index)" class="highlighted">{{part}}</span></span></pre>\n</section>\n<section class="hidden-container">\n  <article class="tether-pop"></article>\n</section>')}]),angular.module("textaculous").service("textaculous.drop",["textaculous.parser",function(a){function c(b,c){var d=b.highlightedRanges,e=b.positionStart,f=b.positionEnd,g=b.event,h=b.node;f=f||e;var i=a.isInRange(d,{start:e,end:f});return~i?(this.pop({index:i,node:h},c),g&&g.stopPropagation()):this.close(),i}function d(a,b){var c=a.index,d=a.node,e=void 0===c?d:d.querySelectorAll(".highlighted")[c];e&&e!==h&&(g&&g.destroy(),g=new Drop({target:e,content:b,classes:"drop-theme-arrows-bounce",position:"bottom left",constrainToWindow:!1,constrainToScrollParent:!1,openOn:""}),h=e,g.content.addEventListener("click",function(a){return a.stopPropagation()}),g.setupTether(),g.open())}function e(){g&&(h=null,g.close())}function f(){var a=this,c=b.querySelector("html");c.addEventListener("click",function(){return a.close()})}var g,h;this.trigger=c,this.pop=d,this.close=e,this._init=f,this._init()}]),angular.module("textaculous").service("textaculous.parser",["textaculous.constants.config",function(a){function b(a,b){for(var c=b.start,d=b.end,e=-1,f=0;f<a.length;f++)if(a[f][0]<=c&&d<=a[f][1]){e=f;break}return e}function c(b){for(var c=d(b),e=0,f=[],g=[],h=[],i=0;i<c.length;i++)c[i][0]===a.tag&&(h.push(c[i]),g.push(i),f.push([e,e+c[i].length])),e+=c[i].length;return{splitted:c,highlightedRanges:f,highlighted:h,highlightedIndexes:g}}function d(a){return a.split(f)}function e(a){return new RegExp("(\\"+a+"[^\\s]+)")}var f=e(a.tag);this.parse=c,this.isInRange=b}]),angular.module("textaculous").controller("textaculous.controllers.textaculous",function(){this.$$ranges=[],this.$$highlighted=[],this.$$highlightedIndexes=[],this.$$textarea=void 0,this.$$tetherContent=void 0,this.$$currentIndex=-1});var c=function(a,b){if(Array.isArray(a))return a;if(Symbol.iterator in Object(a)){for(var c,d=[],e=a[Symbol.iterator]();!(c=e.next()).done&&(d.push(c.value),!b||d.length!==b););return d}throw new TypeError("Invalid attempt to destructure non-iterable instance")};angular.module("textaculous").directive("textaculous",["textaculous.parser","textaculous.drop","$interval",function(a,b){return{scope:{raw:"=ngModel"},restrict:"AE",templateUrl:"../lib/templates/textaculous.jade",controller:"textaculous.controllers.textaculous",controllerAs:"Textaculous",require:["textaculous","ngModel"],transclude:!0,compile:function(){return function(d,e,f,g,h){function i(a){return d.raw=""+d.raw.slice(0,k.$$ranges[k.$$currentIndex][0]+1)+a+d.raw.slice(k.$$ranges[k.$$currentIndex][1])}var j=c(g,2),k=j[0],l=(j[1],e[0]);k.text=[],k.$$ranges=[],k.$$highlighted=[],k.$$textarea=l.querySelector("textarea"),k.$$tetherContent=l.querySelector(".tether-pop"),k.$$currentIndex=-1,Object.defineProperties(k,{range:{get:function(){return~k.$$currentIndex?k.$$ranges[k.$$currentIndex]:void 0}},current:{get:function(){return~k.$$currentIndex?k.$$highlighted[k.$$currentIndex].slice(1):""},set:function(a){return!!~k.$$currentIndex&&i(a)}}}),d.selectText=function(a){return k.$$currentIndex=b.trigger({highlightedRanges:k.$$ranges,positionStart:k.$$textarea.selectionStart,positionEnd:k.$$textarea.selectionEnd,event:a,node:l},k.$$tetherContent)},d.isHighlighted=function(a){return!!~k.$$highlightedIndexes.indexOf(a)},d.$watch("raw",function(c){var d=a.parse(c),e=d.highlightedRanges,f=d.splitted,g=d.highlighted,h=d.highlightedIndexes;k.text=f,k.$$ranges=e,k.$$highlighted=g,k.$$highlightedIndexes=h;var i=a.isInRange(k.$$ranges,{start:k.$$textarea.selectionStart,end:k.$$textarea.selectionEnd});~i?k.$$currentIndex=i:(b.close(),k.$$currentIndex=-1)}),h(d,function(a){return angular.element(k.$$tetherContent).append(a)})}}}}]),angular.module("textaculous").directive("highlighted",["textaculous.drop",function(a){return{restrict:"C",scope:{},require:"^textaculous",link:function(b,c,d,e){a.pop({node:c[0]},e.$$tetherContent)}}}])}(window,window.document,window.angular);